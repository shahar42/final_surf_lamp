# Multi-Agent Development Rules

## Universal Standards (ALL AGENTS MUST FOLLOW)

### Code Style & Naming
- **Python**: snake_case for functions/variables, PascalCase for classes
- **Files**: snake_case.py, kebab-case.yml
- **Database**: snake_case table names, lowercase column names
- **API**: kebab-case endpoints (/api/v1/lamp-config)

### Import Standards
```python
# Standard library first
import os
import asyncio
from datetime import datetime

# Third party
from fastapi import FastAPI, Depends
from sqlalchemy import Column, Integer

# Local imports last
from app.core.database import get_db_pool
from app.agents.tools.base import BaseTool
```

### API Response Format (CRITICAL - Arduino Compatibility)
```python
# Arduino endpoint MUST return exactly this format:
{
    "registered": bool,
    "brightness": int,
    "location_used": str,
    "wave_height_m": float | None,
    "wave_period_s": float | None,
    "wind_speed_mps": float | None,
    "wind_deg": int | None,
    "error": str | None
}
```

### Database Conventions
- All tables have: `id`, `created_at`, `updated_at`, `is_active`
- Use UUID for primary keys where external access needed
- Use JSONB for flexible data in PostgreSQL
- All queries must use async/await

### Error Handling Pattern
```python
try:
    result = await some_operation()
    return result
except SpecificError as e:
    logger.error("Operation failed", error=str(e), context=additional_info)
    raise HTTPException(status_code=400, detail="User friendly message")
except Exception as e:
    logger.error("Unexpected error", error=str(e))
    raise HTTPException(status_code=500, detail="Server error")
```

## Agent-Specific Rules

### Grok (Python Specialist)
- Focus on business logic and data processing
- Use async/await for all I/O operations
- Include comprehensive docstrings
- Add type hints to all functions
- Include error handling with structured logging

### ChatGPT (Infrastructure Specialist) 
- Create production-ready configs
- Include comments explaining configuration choices
- Use environment variables for sensitive data
- Include health checks and monitoring

### Gemini Pro (Data & Docs Specialist)
- Generate complete schemas with indexes
- Include seed data and migration scripts
- Create comprehensive documentation
- Use proper SQL formatting and comments

## Integration Requirements

### File Headers
All generated files must start with:
```python
"""
Generated by: [Agent Name]
Purpose: [Brief description]
Dependencies: [List key dependencies]
"""
```

### Logging Format
```python
import structlog
logger = structlog.get_logger(__name__)

# Usage
logger.info("Operation completed", 
           operation="lamp_config", 
           lamp_id=lamp_id, 
           status="success")
```

### Testing Requirements
- Every function needs a corresponding test
- Use pytest with async support
- Include both success and failure cases
- Mock external dependencies

## Critical Integration Points

### Database Connection
- All agents use same connection pool pattern
- Use `Depends(get_db_pool)` in FastAPI
- Always use transactions for multi-step operations

### Agent Tool Interface
```python
class BaseTool:
    async def execute(self, input_data: dict) -> dict:
        """Standard interface all tools must implement"""
        pass
```

### Environment Variables
```
# Database
DATABASE_URL=postgresql://...
DATABASE_POOL_SIZE=20

# External APIs  
SURFLINE_API_KEY=...
WEATHER_API_KEY=...

# Security
SECRET_KEY=...
```

## Output Requirements

### Code Generation
- Include all imports at top
- Add main execution guard: `if __name__ == "__main__":`
- Include basic error handling
- Use proper async patterns

### Documentation
- Include setup instructions
- Add API examples
- Document environment variables
- Include troubleshooting section

## Quality Checks

Before submitting any code:
1. ✅ Follows naming conventions
2. ✅ Includes proper imports
3. ✅ Has error handling
4. ✅ Uses async/await correctly
5. ✅ Matches expected API interfaces
6. ✅ Includes type hints
7. ✅ Has docstrings# TODO: Add content for agent_rules.md
