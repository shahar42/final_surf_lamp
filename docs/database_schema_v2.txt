╔════════════════════════════════════════════════════════════════════════════════════════╗
║                   SURF LAMP DATABASE SCHEMA v2.0 - VISUAL REFERENCE                  ║
║                          ═══════════════════════════════════                          ║
║  USE CASE: Comprehensive visual schema with security & deployment context             ║
║  AUDIENCE: Database administrators, security auditors, deployment teams               ║
║  FORMAT: Enhanced ASCII with emojis, sections, and detailed annotations               ║
╚════════════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                 🔐 AUTHENTICATION LAYER                                │
└─────────────────────────────────────────────────────────────────────────────────────────┘

             ┌─────────────────────────────┐
             │       👤 USERS              │
             │ ═══════════════════════════ │
             │ 🔑 user_id: INTEGER [PK]    │
             │ 📧 email: VARCHAR(255) [UQ] │
             │ 👥 username: VARCHAR(255)[UQ│
             │ 🔒 password_hash: TEXT      │
             │ 📍 location: VARCHAR(255)   │
             │ 🎨 theme: VARCHAR(50)       │
             │ 📊 preferred_output: VARCH  │
             │ 🌊 wave_threshold_m: FLOAT  │
             │ 💨 wind_threshold_knots: FLOAT │
             └─────────────────────────────┘
                           │
                           │ 1:M
                           ▼
             ┌─────────────────────────────┐
             │   🔑 PASSWORD_RESET_TOKENS  │
             │ ═══════════════════════════ │
             │ 🆔 id: UUID [PK]            │
             │ 👤 user_id: INTEGER [FK]    │
             │ 🔐 token_hash: VARCHAR(128) │
             │ ⏰ expiration_time: TIMESTAMP│
             │ 📅 created_at: TIMESTAMP    │
             │ ✅ used_at: TIMESTAMP       │
             │ ❌ is_invalidated: BOOLEAN  │
             └─────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              💡 DEVICE & CONDITIONS LAYER                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘

             ┌─────────────────────────────┐
             │       💡 LAMPS              │
             │ ═══════════════════════════ │
             │ 🔑 lamp_id: INTEGER [PK]    │
             │ 👤 user_id: INTEGER [FK]    │
             │ 🤖 arduino_id: INTEGER [UQ] │
             │ 🌐 arduino_ip: VARCHAR(15)  │
             │ 🕐 last_updated: TIMESTAMP  │
             └─────────────────────────────┘
                           │
                           │ 1:1
                           ▼
             ┌─────────────────────────────┐
             │    🌊 CURRENT_CONDITIONS    │
             │ ═══════════════════════════ │
             │ 🔑 lamp_id: INTEGER [PK/FK] │
             │ 📏 wave_height_m: FLOAT     │
             │ ⏱️ wave_period_s: FLOAT     │
             │ 💨 wind_speed_mps: FLOAT    │
             │ 🧭 wind_direction_deg: INT  │
             │ 🕐 last_updated: TIMESTAMP  │
             └─────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                             🌐 API MANAGEMENT & ROUTING LAYER                           │
└─────────────────────────────────────────────────────────────────────────────────────────┘

             ┌─────────────────────────────┐
             │      🌐 DAILY_USAGE         │
             │ ═══════════════════════════ │
             │ 🔑 usage_id: INTEGER [PK]   │
             │ 🔗 website_url: VARCHAR(255)│
             │ 🕐 last_updated: TIMESTAMP  │
             └─────────────────────────────┘
                           │
                           │ 1:1
                           ▼
             ┌─────────────────────────────┐
             │   📍 LOCATION_WEBSITES      │
             │ ═══════════════════════════ │
             │ 🔑 location: VARCHAR(255)[PK│
             │ 🌐 usage_id: INTEGER [FK/UQ]│
             └─────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           🔗 MANY-TO-MANY RELATIONSHIP BRIDGE                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────┐
                    │      🔗 USAGE_LAMPS         │
                    │ ═══════════════════════════ │
                    │ 🔑 usage_id: INTEGER [PK/FK]│
                    │ 🔑 lamp_id: INTEGER [PK/FK] │
                    │ 🔐 api_key: TEXT            │
                    │ 🌐 http_endpoint: TEXT      │
                    │ ⭐ endpoint_priority: INT   │
                    └─────────────────────────────┘
                              │              │
                              │              │
                ┌─────────────┘              └─────────────┐
                │                                          │
                ▼                                          ▼
   ┌─────────────────────────────┐            ┌─────────────────────────────┐
   │      🌐 DAILY_USAGE         │            │       💡 LAMPS              │
   │ ═══════════════════════════ │            │ ═══════════════════════════ │
   │ 🔑 usage_id: INTEGER [PK]   │            │ 🔑 lamp_id: INTEGER [PK]    │
   │ 🔗 website_url: VARCHAR(255)│            │ 👤 user_id: INTEGER [FK]    │
   │ 🕐 last_updated: TIMESTAMP  │            │ 🤖 arduino_id: INTEGER [UQ] │
   └─────────────────────────────┘            │ 🌐 arduino_ip: VARCHAR(15)  │
                                               │ 🕐 last_updated: TIMESTAMP  │
                                               └─────────────────────────────┘

╔════════════════════════════════════════════════════════════════════════════════════════╗
║                                🔄 DATA FLOW DIAGRAM                                   ║
╚════════════════════════════════════════════════════════════════════════════════════════╝

                           🌐 EXTERNAL APIs
                         ┌──────────────────┐
                         │  🌊 Marine APIs  │
                         │  💨 Weather APIs │
                         │  📊 NOAA APIs    │
                         └──────────────────┘
                                   │
                                   │ HTTP Requests
                                   ▼
                         ┌──────────────────┐
                         │ ⚙️ BACKGROUND     │ ──┐
                         │   PROCESSOR      │   │
                         └──────────────────┘   │
                                   │            │
                                   │ SQL        │ Populate
                                   ▼            │
                         ┌──────────────────┐   │
                ┌────────┤ 🗄️ POSTGRESQL    │◄──┘
                │        │   DATABASE       │
                │        └──────────────────┘
                │                  │
                │ SQL              │ SQL
                ▼                  ▼
    ┌──────────────────┐ ┌──────────────────┐
    │ 🌐 FLASK WEB     │ │ 🤖 ARDUINO       │
    │   APPLICATION    │ │   DEVICES        │
    └──────────────────┘ └──────────────────┘
              │                    │
              │ HTTPS              │ HTTP
              ▼                    ▼
    ┌──────────────────┐ ┌──────────────────┐
    │ 👥 USER          │ │ 💡 LED STRIPS    │
    │   DASHBOARD      │ │   VISUALIZATION  │
    └──────────────────┘ └──────────────────┘

╔════════════════════════════════════════════════════════════════════════════════════════╗
║                            🏗️ SYSTEM ARCHITECTURE LAYERS                             ║
╚════════════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                               🖥️ PRESENTATION LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│  📱 Web Dashboard (Flask Templates) │  🤖 Arduino Status API  │  💡 LED Visualization │
│  • User Authentication              │  • Device Monitoring    │  • Wave Height        │
│  • Real-time Data Display          │  • Manual Data Fetch    │  • Wind Speed/Dir     │
│  • Preference Management           │  • System Health Check  │  • Wave Period        │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                🔧 BUSINESS LOGIC LAYER                                │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│  🌐 Flask Application (app.py)      │  ⚙️ Background Processor │  🔍 Server Discovery │
│  • User Registration/Login          │  • API Data Fetching     │  • GitHub Config     │
│  • Lamp Configuration              │  • Data Processing        │  • Fallback Servers  │
│  • Password Reset System           │  • Database Updates       │  • Health Monitoring │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                 🗄️ DATA ACCESS LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│  🔐 SQLAlchemy ORM (data_base.py)   │  📊 API Integration      │  🔒 Security Controls │
│  • User/Lamp/Conditions Models     │  • Marine Weather APIs   │  • Rate Limiting      │
│  • Relationship Management         │  • Priority Fallbacks    │  • CSRF Protection    │
│  • Transaction Handling            │  • Data Validation       │  • Input Sanitization │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                           │
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                               💾 PERSISTENCE LAYER                                    │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│  🗄️ PostgreSQL Database            │  ⚡ Redis Cache           │  📁 File System       │
│  • Relational Data Storage         │  • Session Management    │  • Configuration Files │
│  • ACID Transactions               │  • Rate Limit Tracking   │  • Log Files           │
│  • Foreign Key Constraints         │  • Background Job Queue  │  • Static Assets       │
└─────────────────────────────────────────────────────────────────────────────────────────┘

╔════════════════════════════════════════════════════════════════════════════════════════╗
║                              🔐 SECURITY ARCHITECTURE                                 ║
╚════════════════════════════════════════════════════════════════════════════════════════╝

                    🛡️ MULTI-LAYER SECURITY IMPLEMENTATION
                   ═══════════════════════════════════════

┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 🌐 NETWORK  │────▶│ 🔒 SESSION  │────▶│ 🗄️ DATABASE │────▶│ 📱 DEVICE   │
│ SECURITY    │     │ SECURITY    │     │ SECURITY    │     │ SECURITY    │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
      │                     │                     │                     │
      ▼                     ▼                     ▼                     ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│• HTTPS Only │     │• bcrypt Hash│     │• FK Cascade │     │• WiFi WPA3  │
│• Rate Limit │     │• CSRF Token │     │• Param Query│     │• Local Auth │
│• DDoS Protect     │• Session Exp│     │• Transaction│     │• Status API │
│• Firewall   │     │• Token Valid│     │• Constraint │     │• Discovery  │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘

╔════════════════════════════════════════════════════════════════════════════════════════╗
║                            📊 MONITORING & OBSERVABILITY                              ║
╚════════════════════════════════════════════════════════════════════════════════════════╝

    🔍 SYSTEM HEALTH MONITORING                 📈 PERFORMANCE METRICS
   ═══════════════════════════════            ══════════════════════════

┌──────────────────────────┐               ┌──────────────────────────┐
│ 🌐 API Endpoint Health   │               │ 📊 Database Performance  │
│ • Response Times         │               │ • Query Execution Time   │
│ • Success/Failure Rates  │               │ • Connection Pool Usage  │
│ • Data Freshness        │               │ • Transaction Rollbacks  │
└──────────────────────────┘               └──────────────────────────┘
              │                                         │
              ▼                                         ▼
┌──────────────────────────┐               ┌──────────────────────────┐
│ 🤖 Arduino Device Status │               │ 🔄 Background Processing │
│ • Connection Status      │               │ • Job Queue Depth        │
│ • Last Data Update      │               │ • Processing Latency     │
│ • LED Strip Health      │               │ • Error Rates            │
└──────────────────────────┘               └──────────────────────────┘

                           📋 LOGGING STRATEGY
                          ═══════════════════

                    ┌─────────────────────────┐
                    │ 📝 CENTRALIZED LOGGING  │
                    │ ═══════════════════════ │
                    │ • Application Logs      │
                    │ • API Request/Response  │
                    │ • Database Operations   │
                    │ • Security Events       │
                    │ • Performance Metrics   │
                    └─────────────────────────┘

╔════════════════════════════════════════════════════════════════════════════════════════╗
║                             🚀 DEPLOYMENT ARCHITECTURE                                ║
╚════════════════════════════════════════════════════════════════════════════════════════╝

                         PRODUCTION DEPLOYMENT TOPOLOGY
                        ═══════════════════════════════

    ☁️ CLOUD INFRASTRUCTURE              🏠 HOME NETWORK            📱 MOBILE/WEB
   ══════════════════════                ═════════════              ═════════════

┌─────────────────────┐                ┌─────────────────────┐    ┌─────────────────────┐
│ 🌐 Load Balancer    │                │ 🏠 Home Router      │    │ 📱 User Dashboard   │
│ • SSL Termination  │                │ • Port Forwarding   │    │ • React/Vue.js      │
│ • Auto Scaling     │                │ • DHCP Management   │    │ • PWA Support       │
└─────────────────────┘                └─────────────────────┘    └─────────────────────┘
          │                                      │                           │
          ▼                                      ▼                           ▼
┌─────────────────────┐                ┌─────────────────────┐    ┌─────────────────────┐
│ 🖥️ Web Servers      │◄──────────────▶│ 💡 Arduino Devices │    │ 🔐 Authentication   │
│ • Flask App        │                │ • ESP32 Controllers │    │ • OAuth2/JWT        │
│ • Gunicorn WSGI    │                │ • LED Strip Control │    │ • Multi-factor Auth │
└─────────────────────┘                └─────────────────────┘    └─────────────────────┘
          │                                                                   │
          ▼                                                                   ▼
┌─────────────────────┐                                          ┌─────────────────────┐
│ 🗄️ Database Cluster │                                          │ 📊 Analytics        │
│ • PostgreSQL HA    │                                          │ • Usage Metrics     │
│ • Read Replicas    │                                          │ • Performance Data  │
│ • Automated Backup │                                          │ • User Behavior     │
└─────────────────────┘                                          └─────────────────────┘

            SCALABILITY PATTERNS                    RELIABILITY PATTERNS
           ═══════════════════════                 ════════════════════════

┌─────────────────────────────────┐            ┌─────────────────────────────────┐
│ 📈 HORIZONTAL SCALING           │            │ 🔄 FAULT TOLERANCE             │
│ • Container Orchestration       │            │ • Circuit Breakers              │
│ • Microservice Architecture     │            │ • Graceful Degradation          │
│ • API Gateway Pattern          │            │ • Health Checks                 │
│ • Database Sharding            │            │ • Automatic Failover           │
└─────────────────────────────────┘            └─────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════════════════
                               END OF SCHEMA DIAGRAM v2.0
═══════════════════════════════════════════════════════════════════════════════════════════